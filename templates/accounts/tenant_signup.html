{% extends "base.html" %}

{% block title %}Cadastro de Inquilino - alugAE{% endblock %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-screen px-6 py-8">
    <div class="w-full max-w-md bg-white shadow-md rounded-lg p-8">
        
        <!-- Barra de Progresso -->
        <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
            <div id="progress-bar" class="bg-green-500 h-2 rounded-full w-1/3"></div>
        </div>

        <h2 class="text-2xl font-bold text-green-700 text-center">Cadastro de Inquilino</h2>
        <p class="text-gray-600 text-center mt-3">Preencha os campos abaixo para criar sua conta.</p>

        <form method="post" enctype="multipart/form-data" class="mt-8 w-full">
            {% csrf_token %}

            <!-- Etapa 1 - Dados Pessoais -->
            <div id="step-1" class="step">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">游늶 Dados Pessoais</h3>

                <label class="text-gray-700 font-medium">Primeiro Nome</label>
                <input type="text" name="first_name" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <label class="text-gray-700 font-medium mt-4">Sobrenome(s) <span class="text-sm text-gray-500">(Insira todos)</span></label>
                <input type="text" name="last_name" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <label class="text-gray-700 font-medium mt-4">CPF</label>
                <input type="text" name="cpf" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <!-- Adoption Code -->
                <div class="flex justify-between items-center mt-4">
                    <label class="text-gray-700 font-medium">C칩digo de Ado칞칚o</label>
                    <span id="adoptionMessage" class="text-sm text-gray-500"></span>
                </div>
                <input type="text" id="adoption_code" name="adoption_code" required 
                       class="input input-bordered w-full text-gray-800 rounded-lg py-3">

                <button type="button" class="btn btn-success w-full mt-6 next-step">Pr칩ximo</button>
            </div>

            <!-- Etapa 2 - Dados para Contratos -->
            <div id="step-2" class="step hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">游닇 Dados para Contratos</h3>

                <label class="text-gray-700 font-medium">Estado Civil</label>
                <input type="text" name="marital_status" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <label class="text-gray-700 font-medium mt-4">Profiss칚o</label>
                <input type="text" name="profession" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <div class="flex justify-between mt-6">
                    <button type="button" class="btn btn-outline btn-success prev-step">Voltar</button>
                    <button type="button" class="btn btn-success next-step">Pr칩ximo</button>
                </div>
            </div>

            <!-- Etapa 3 - Dados Cadastrais para Login -->
            <div id="step-3" class="step hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">游댐 Dados Cadastrais para Login</h3>

                <label class="text-gray-700 font-medium">Email</label>
                <input type="email" name="email" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <label class="text-gray-700 font-medium mt-4">Celular <span class="text-sm text-gray-500">(Precisa ter WhatsApp)</span></label>
                <input type="text" name="phone" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <label class="text-gray-700 font-medium mt-4">Senha</label>
                <input type="password" name="password" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <label class="text-gray-700 font-medium mt-4">Confirme sua Senha</label>
                <input type="password" name="password_confirm" required class="input input-bordered w-full bg-gray-200 text-gray-800 rounded-lg py-3">

                <div class="flex justify-between mt-6">
                    <button type="button" class="btn btn-outline btn-success prev-step">Voltar</button>
                    <button type="submit" class="btn btn-success">Criar Conta</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Script para fazer a navega칞칚o entre as etapas e preencher o Adoption Code -->
<script>
    const steps = document.querySelectorAll('.step');
    const progressBar = document.getElementById('progress-bar');
    let currentStep = 0;

    function showStep(stepIndex) {
        steps.forEach((step, index) => {
            step.classList.toggle('hidden', index !== stepIndex);
        });
        progressBar.style.width = `${(stepIndex + 1) * 33}%`;
    }

    document.querySelectorAll('.next-step').forEach(button => {
        button.addEventListener('click', () => {
            if (currentStep < steps.length - 1) {
                currentStep++;
                showStep(currentStep);
            }
        });
    });

    document.querySelectorAll('.prev-step').forEach(button => {
        button.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        });
    });

    showStep(currentStep);

    // Preencher o c칩digo de ado칞칚o automaticamente se vier na URL
    function setAdoptionCode() {
        const urlParams = new URLSearchParams(window.location.search);
        const adoptionCode = urlParams.get('adoption_code');  // Obt칠m o c칩digo da URL
        const inputField = document.getElementById('adoption_code');
        const messageField = document.getElementById('adoptionMessage');

        if (adoptionCode) {
            inputField.value = adoptionCode;  // Preenche automaticamente
            inputField.setAttribute('readonly', 'true');  // Torna o campo imut치vel
            inputField.classList.add('bg-green-200');  // Muda a cor para destacar
            messageField.innerText = "Este c칩digo lhe associa automaticamente ao propriet치rio";
            messageField.classList.add('text-green-600');  // Torna a mensagem verde
        } else {
            messageField.innerText = "Pe칞a ao propriet치rio do im칩vel";
            messageField.classList.add('text-red-500');  // Torna a mensagem vermelha
            inputField.classList.add('bg-gray-200'); 
        }
    }

    window.onload = setAdoptionCode;
</script>
{% endblock %}
